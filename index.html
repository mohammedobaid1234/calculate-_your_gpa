<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    />
    <title>Document</title>
    <style>
      body {
        direction: rtl;
        width: 50%;
        margin: auto;
        font-size: 15px;
      }
      th{
        width: 140px;
        background-color: #00ccff;
      }
      .table_a tr td:first-child{
        width: 140px;
        background-color: #00ccff;
      }
      .table_a  tr td:first-child{
        width: 140px;
        background-color: #00ccff;
      }
      .table_a  tr:first-of-type td {
        /* width: 100%; */
        background-color: #fff;
      }
      .table_a tr:nth-of-type(2) td{
        width: 140px;
        background-color: #fff;
      }
      .table_a  tr:last-of-type td{
         /* width: 100%; */
         padding-top: 30px;
        background-color: #fff;
      }
    </style>
  </head>

  <body>
    <div class="text-center">
      <div class="container">
        <h5>أحسب معدلك التراكمي</h5>

        <form method="POST" id="gpa">
          <div class="wrapper">
            <table class="table_a">
              <tbody>
                <tr>
                  <td>معدلك التراكمي قبل الفصل الحالي</td>
                  <td colspan="3">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="T1"
                      size="20"
                      max="100"
                      required=""
                    />
                  </td>
                </tr>
                <tr>
                  <td valign="top">عدد الساعات التي قطعتها قبل الفصل الحالي</td>
                  <td colspan="3">
                    <input
                      type="number"
                      inputmode="decimal"
                      name="T2"
                      size="20"
                      required=""
                    /><br />
                    <span style="color: #ff0000"
                      >* يشمل كافة المواد التي تم اجتيازها بنجاح وايضاً المواد
                      التي رسبت فيها ولم تعدها قبل الفصل الحالي
                      <br />
                    </span>
                  </td>
                </tr>
                <tr>
                  <th>علامات مواد الفصل الحالي</th>
                  <th align="center">العلامة</th>
                  <th align="center">عدد الساعات</th>
                  <th align="center">
                    اذا كانت المادة معادة أدخل العلامة السابقة للمادة
                  </th>
                </tr>
                <tr>
                  <td>المادة <span lang="en-us">1</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr
                  onmouseover="if (!window.__cfRLUnblockHandlers) return false; className='td_hl'"
                  onmouseout="if (!window.__cfRLUnblockHandlers) return false; className=''"
                  class=""
                >
                  <td>المادة <span lang="en-us">2</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr>
                  <td>المادة <span lang="en-us">3</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr
                  onmouseover="if (!window.__cfRLUnblockHandlers) return false; className='td_hl'"
                  onmouseout="if (!window.__cfRLUnblockHandlers) return false; className=''"
                  class=""
                >
                  <td>المادة <span lang="en-us">4</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr>
                  <td>المادة <span lang="en-us">5</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr
                  onmouseover="if (!window.__cfRLUnblockHandlers) return false; className='td_hl'"
                  onmouseout="if (!window.__cfRLUnblockHandlers) return false; className=''"
                  class=""
                >
                  <td>المادة <span lang="en-us">6</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr>
                  <td>المادة <span lang="en-us">7</span></td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="subjects[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                  <td align="center">
                    <select size="1" name="hours[]">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3" selected="">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                    </select>
                  </td>
                  <td align="center">
                    <input
                      type="number"
                      inputmode="decimal"
                      step="0.01"
                      name="re[]"
                      max="100"
                      placeholder="تجاهل"
                    />
                  </td>
                </tr>
                <tr>
                  <td colspan="4" class="text-center">
                    <input
                      type="submit"
                      value="احسب معدلي التراكمي"
                      name="B1"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </form>
        <table
          style="
            font-size: 12px;
            font-family: Tahoma;
            text-align: center;
            margin: auto;
            margin-top: 30px;
          "
          cellspacing="2"
          cellpadding="2"
        >
          <tbody>
            <tr>
              <td
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 140px;
                  border-bottom: #000000 1px solid;
                  background-color: #00ccff;
                "
              >
                مجموع الساعات
              </td>
              <td
                id="hoursCount"
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 100px;
                  border-bottom: #000000 1px solid;
                  text-align: center;
                "
              >
                0
              </td>
            </tr>
            <tr>
              <td
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 140px;
                  border-bottom: #000000 1px solid;
                  background-color: #00ccff;
                "
              >
                المعدل الفصلي
              </td>
              <td
                id="simGrade"
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 100px;
                  border-bottom: #000000 1px solid;
                  text-align: center;
                "
              >
                0%
              </td>
            </tr>
            <tr>
              <td
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 140px;
                  border-bottom: #000000 1px solid;
                  background-color: #00ccff;
                "
              >
                المعدل التراكمي الناتج
              </td>
              <td
                id="totalGrade"
                style="
                  border-right: #000000 1px solid;
                  border-top: #000000 1px solid;
                  border-left: #000000 1px solid;
                  width: 100px;
                  border-bottom: #000000 1px solid;
                  text-align: center;
                "
              >
                0%
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  <script>
    $("#gpa").submit(function (e) {
        e.preventDefault();
        var $current_hours = $('input[name="T2"]').val();
        $current_gpa = $('input[name="T1"]').val();
      var hours = [];
      var subjects = [];
      var re = [];
      $values = 0;
      $hoursCount = 0;
      $("select[name='hours[]']").each(function () {
        hours.push($(this).val());
      });
      $("input[name='re[]']").each(function () {

        re.push($(this).val());
      });
      $("input[name='subjects[]']").each(function () {
        subjects.push($(this).val());
        
      });

      for ($i = 0; $i < subjects.length; $i++) {
        const element = subjects[$i];
        if (element != 0 && element != '') {
            if (re[$i] != '') {

            $value = element * parseFloat(hours[$i]);
            $current_gpa =
              ($current_gpa * $current_hours - re[$i] * parseFloat(hours[$i])) /
              ($current_hours - parseFloat(hours[$i]));
            $current_hours -= parseFloat(hours[$i]);
            $current_gpa =
              ($current_gpa * $current_hours + $value) /
              ($current_hours + parseFloat(hours[$i]));
            $current_hours += parseFloat(hours[$i]);
            continue;
          }
          $values += element * parseFloat(hours[$i]);
          $hoursCount += parseFloat(hours[$i]);
        } else {
          continue;
        }
      }
      $semester_avg = 0;
      $semester_hours = 0;
      for ($i = 0; $i < subjects.length; $i++) {
        const element = subjects[$i];
        if (element != '') {
          if (element != 0 && element != '') {
            $semester_avg += element * parseFloat(hours[$i]);
            $semester_hours += parseFloat(hours[$i]);
          } else {
            continue;
          }
        }
      }
      $("#simGrade").text(($semester_avg / $semester_hours).toFixed(3));
      $("#hoursCount").text(parseFloat($hoursCount) + parseFloat($current_hours));
      $("#totalGrade").text(
        (
          (parseFloat($values )+ parseFloat($current_gpa) * parseFloat($current_hours)) /
          (parseFloat($hoursCount) + parseFloat($current_hours))
        ).toFixed(3)
      );
    });
  </script>
</html>
